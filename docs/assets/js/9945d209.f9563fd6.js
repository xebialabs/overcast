"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[19],{9102:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return u},assets:function(){return c},toc:function(){return p},default:function(){return d}});var n=a(7462),o=a(3366),s=(a(7294),a(3905)),r=["components"],i={title:"How to run integration tests against VM Ware",tags:["overcast","vmware","integration-test"]},l=void 0,u={permalink:"/overcast/blog/2021/09/15/how-to-run-integration-tests-against-vmware",source:"@site/blog/2021-09-15-how-to-run-integration-tests-against-vmware.md",title:"How to run integration tests against VM Ware",description:"This article is for you, if you have to run VMs for your integration tests, and you use as a hypervisor - VM Ware 7.0",date:"2021-09-15T00:00:00.000Z",formattedDate:"September 15, 2021",tags:[{label:"overcast",permalink:"/overcast/blog/tags/overcast"},{label:"vmware",permalink:"/overcast/blog/tags/vmware"},{label:"integration-test",permalink:"/overcast/blog/tags/integration-test"}],readingTime:2.745,truncated:!1,authors:[]},c={authorsImageUrls:[]},p=[],h={toc:p};function d(e){var t=e.components,i=(0,o.Z)(e,r);return(0,s.kt)("wrapper",(0,n.Z)({},h,i,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"This article is for you, if you have to run VMs for your integration tests, and you use as a hypervisor - VM Ware 7.0\nor above."),(0,s.kt)("p",null,"The flow of each test case is the following: "),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Test case flow",src:a(7056).Z})),(0,s.kt)("p",null,"The participation of this library is for 2 blocks, to set up VM and to tear it down.\nIn order to set up VM you have to choose which one you need.\nFor that you are preparing it in your VMWare, like for example, ",(0,s.kt)("inlineCode",{parentName:"p"},"base-ubuntu20")," and during the test run it will be cloned.\nThe image is cloned so that it can be reused multiple times, and you can run parallel tests. "),(0,s.kt)("p",null,"There are two ways to clone the VM, ",(0,s.kt)("strong",{parentName:"p"},"clone")," and ",(0,s.kt)("strong",{parentName:"p"},"instant clone"),":",(0,s.kt)("br",null)," "),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Clone")," you can do on Powered off base images.",(0,s.kt)("br",null)),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Instant clone")," works only on images which are Powered on, because it happens on the memory level,\nand the clone process significantly faster. ")),(0,s.kt)("p",null,"The operational process is happening via REST API. "),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"First we open the session, and for that we have to know the API host of the VMWare and credentials. Credentials\nare provided as a base 64 encrypted hash of ",(0,s.kt)("inlineCode",{parentName:"li"},"username:password"),". Once you have it you define it in your ",(0,s.kt)("inlineCode",{parentName:"li"},"overcast.conf")," like:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script title=overcast.conf",script:!0,title:"overcast.conf"},"overcastVMWareHost { # this is an arbitrary name which will be used in your test to read the configuration section.\n    ...\n    vmwareApiHost=my_api_host \n    vmwareAuthHashCredentials=my_hash_credentials\n    ... \n}\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Then by VM name we have to find what is VM id is. To define the base image in overcast you have to add this property:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script title=overcast.conf",script:!0,title:"overcast.conf"},"overcastVMWareHost {\n    ...\n    vmBaseImage=my_base_image_name\n    ...\n}\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Having ",(0,s.kt)("inlineCode",{parentName:"li"},"sessionId")," and ",(0,s.kt)("inlineCode",{parentName:"li"},"vmId")," is enough to start the cloning. Though you can choose between the type of cloning. By\ndefault, it is ",(0,s.kt)("strong",{parentName:"li"},"instant clone"),", if by some reason you want to use a usual clone, you can add this line to the configuration:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script title=overcast.conf",script:!0,title:"overcast.conf"},"overcastVMWareHost {\n    ...\n    instantClone=false\n    ...\n}\n")),(0,s.kt)("p",null,"In my case, I got 120 seconds to clone CentOs 7, and 3 seconds to instantly clone the same image.\nThe difference is phenomenal. But take into account that the base image has to be powered on for the instant clone."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Then you are provisioning your VM, if it is required. You can for example use ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/xebialabs/overthere"},"Overthere"),"\nfor that. Or you can skip it and have already base image provisioned for your testing needs.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"After it's a time to execute the test logic itself.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Once all is done, as the best practice, we have to utilise all our resources. For that we are shutting down the VM and\ndeleting it."),(0,s.kt)("p",{parentName:"li"},"The snippet of the code which you can use as a scaffold for that is:"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-java"},'    @Test\n    public void shouldCloneAndDisposeVm() {\n        VMWareHost h = (VMWareHost) CloudHostFactory.getCloudHost("overcastVMWareHost");\n        try {\n            h.setup();\n\n            assertThat(h.getSessionId().length(), is(32));\n            assertThat(h.getHostName(), notNullValue());\n        } catch (Exception e) {\n            fail(e.getMessage());\n        } finally {\n            h.teardown();\n        }\n    }\n')),(0,s.kt)("p",null,"As we can see from here in this line ",(0,s.kt)("br",null)," "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-java"},'VMWareHost h = (VMWareHost) CloudHostFactory.getCloudHost("overcastVMWareHost");\n')),(0,s.kt)("br",null)," we are reading from the defined section `overcastVMWareHost`. The casting is not necessary here. ",(0,s.kt)("br",null),"It is only to verify that session was properly created. As it is specified for VMWare implementation.",(0,s.kt)("p",null,"After ",(0,s.kt)("inlineCode",{parentName:"p"},"h.setup()")," you can do provisioning and writing your test scenario."))}d.isMDXComponent=!0},7056:function(e,t,a){t.Z=a.p+"assets/images/vmware-test-case-flow-5b80eaa38ddb8f6d28abf2aa5f5295bd.jpg"}}]);