<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/overcast/blog/rss.xml" title="Overcast Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/overcast/blog/atom.xml" title="Overcast Blog Atom Feed"><title data-react-helmet="true">Blog | Overcast</title><meta data-react-helmet="true" property="og:title" content="Blog | Overcast"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/overcast/blog"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/overcast/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/overcast/blog"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/overcast/blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/overcast/blog" hreflang="x-default"><link rel="stylesheet" href="/overcast/assets/css/styles.fb53c356.css">
<link rel="preload" href="/overcast/assets/js/runtime~main.413dd61c.js" as="script">
<link rel="preload" href="/overcast/assets/js/main.92ef1da3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/overcast/"><img src="/overcast/img/digital_ai_deploy.svg" alt="Overcast Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/overcast/img/digital_ai_deploy.svg" alt="Overcast Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Overcast</b></a><a class="navbar__item navbar__link" href="/overcast/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/overcast/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/overcast" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/overcast/blog/2021/09/15/how-to-run-integration-tests-against-vmware">How to run integration tests against VM Ware</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/overcast/blog/2021/09/15/how-to-run-integration-tests-against-vmware">How to run integration tests against VM Ware</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-09-15T00:00:00.000Z" itemprop="datePublished">September 15, 2021</time> Â· 3 min read</div></header><div class="markdown" itemprop="articleBody"><p>This article is for you, if you have to run VMs for your integration tests, and you use as a hypervisor - VM Ware 7.0
or above.</p><p>The flow of each test case is the following: </p><p><img alt="Test case flow" src="/overcast/assets/images/vmware-test-case-flow-5b80eaa38ddb8f6d28abf2aa5f5295bd.jpg"></p><p>The participation of this library is for 2 blocks, to set up VM and to tear it down.
In order to set up VM you have to choose which one you need.
For that you are preparing it in your VMWare, like for example, <code>base-ubuntu20</code> and during the test run it will be cloned.
The image is cloned so that it can be reused multiple times, and you can run parallel tests. </p><p>There are two ways to clone the VM, <strong>clone</strong> and <strong>instant clone</strong>:<br> </p><ul><li><strong>Clone</strong> you can do on Powered off base images.<br></li><li><strong>Instant clone</strong> works only on images which are Powered on, because it happens on the memory level,
and the clone process significantly faster. </li></ul><p>The operational process is happening via REST API. </p><ul><li>First we open the session, and for that we have to know the API host of the VMWare and credentials. Credentials
are provided as a base 64 encrypted hash of <code>username:password</code>. Once you have it you define it in your <code>overcast.conf</code> like:</li></ul><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">overcast.conf</div><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">overcastVMWareHost </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># this is an arbitrary name which will be used in your test to read the configuration section.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">vmwareApiHost</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">my_api_host </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">vmwareAuthHashCredentials</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">my_hash_credentials</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Then by VM name we have to find what is VM id is. To define the base image in overcast you have to add this property:</li></ul><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">overcast.conf</div><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">overcastVMWareHost </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">vmBaseImage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">my_base_image_name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Having <code>sessionId</code> and <code>vmId</code> is enough to start the cloning. Though you can choose between the type of cloning. By
default, it is <strong>instant clone</strong>, if by some reason you want to use a usual clone, you can add this line to the configuration:</li></ul><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">overcast.conf</div><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">overcastVMWareHost </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">instantClone</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In my case, I got 120 seconds to clone CentOs 7, and 3 seconds to instantly clone the same image.
The difference is phenomenal. But take into account that the base image has to be powered on for the instant clone.</p><ul><li><p>Then you are provisioning your VM, if it is required. You can for example use <a href="https://github.com/xebialabs/overthere" target="_blank" rel="noopener noreferrer">Overthere</a>
for that. Or you can skip it and have already base image provisioned for your testing needs.</p></li><li><p>After it&#x27;s a time to execute the test logic itself.</p></li><li><p>Once all is done, as the best practice, we have to utilise all our resources. For that we are shutting down the VM and
deleting it.</p><p>The snippet of the code which you can use as a scaffold for that is:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void shouldCloneAndDisposeVm() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        VMWareHost h = (VMWareHost) CloudHostFactory.getCloudHost(&quot;overcastVMWareHost&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            h.setup();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            assertThat(h.getSessionId().length(), is(32));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            assertThat(h.getHostName(), notNullValue());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            fail(e.getMessage());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            h.teardown();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As we can see from here in this line <br> </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">VMWareHost h = (VMWareHost) CloudHostFactory.getCloudHost(&quot;overcastVMWareHost&quot;);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><br> we are reading from the defined section `overcastVMWareHost`. The casting is not necessary here. <br>It is only to verify that session was properly created. As it is specified for VMWare implementation.<p>After <code>h.setup()</code> you can do provisioning and writing your test scenario.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/overcast/blog/tags/overcast">overcast</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/overcast/blog/tags/vmware">vmware</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/overcast/blog/tags/integration-test">integration-test</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/overcast/docs/intro">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/overcast/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/xebialabs/overcast" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Overcast Digital.ai</div></div></div></footer></div>
<script src="/overcast/assets/js/runtime~main.413dd61c.js"></script>
<script src="/overcast/assets/js/main.92ef1da3.js"></script>
</body>
</html>